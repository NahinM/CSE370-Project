{% extends 'base.html' %}

{% block content %}
<br><br><br>
<div class="d-flex justify-content-start flex-wrap">
    {% raw %}
    <div class="p-3" ng-repeat=" asset in allAsset">
        <div class="card position-relative" style="width: 18rem; height: 26rem; box-shadow: 0px 0px 5px black;">
            <div class="position-relative" ng-switch="asset.typp">
                <!-- <div class="btn btn-info active "></div> -->
                <span class="z-3 badge rounded-pill text-bg-info position-absolute top-0 start-100 translate-middle">{{asset.typp}}</span>
                <img ng-switch-when="graphics" ng-src="{{asset.contentsrc}}" class="card-img-top" alt="..." width="300" height="250">
                <div ng-switch-when="video" class="ratio ratio-16x9">
                    <iframe ng-src="{{asset.contentsrc | toEmbed | trustAsResourceUrl}}" title="Video player" allowfullscreen></iframe>
                </div>
                <img ng-switch-when="audio" src="https://thumbs.dreamstime.com/b/radio-wave-sound-icon-vector-isolated-electric-signal-171471846.jpg" class="card-img-top" alt="..." width="300" height="250">
            </div>

            <div class="card-body">
                <h5 class="card-title">{{asset.title}}</h5>
                <a ng-href="{{asset.visite}}" class="btn btn-primary">Visite</a>
                <a ng-href="{{asset.detail}}" class="btn btn-primary">Detail</a>
            </div>
        </div>
    </div>
    {% endraw %}
</div>
<div class="d-flex justify-content-between" style="border: 1px solid black;border-radius: 10px;width: 75%;margin-left: 12.5%;">
  <button type="button" class="btn btn-outline-secondary" ng-click="turnPage(-1)">Previous</button>
  {% raw %}
  <div class="p-2">Page {{pageno}}</div>
  {% endraw %}
  <button type="button" class="btn btn-outline-secondary" ng-click="turnPage(1)">Next</button>
</div>
{% endblock  %}

{% block script %}
    $scope.mainctg = "";
    $scope.subctg = "";
    $scope.genre = "";
    $scope.allAsset = [];
    $scope.q = ""
    $scope.user = "{{profile if profile else ""}}";

    $scope.pageno = 1;

    $scope.turnPage = function(a){
        $scope.pageno+=a;
        $scope.pageno = Math.max($scope.pageno,1);
        if($scope.allAsset.length==0 && a==1){
            $scope.pageno-=1;
            return;
        }
        $scope.find();
    }

    $scope.find = function() {
    $http.get(`/search?f=bookmark&q=${$scope.q}&main=${$scope.mainctg}&sub=${$scope.subctg}&genre=${$scope.genre}&user=${$scope.user}&page=${$scope.pageno}`)
        .then(function(response) {
            $scope.allAsset = response.data;
        });
    }
    $scope.find();

{% endblock %}